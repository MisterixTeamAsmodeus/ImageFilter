#pragma once

#include <cstdint>

/**
 * @brief Утилиты для преобразования цветов
 * 
 * Предоставляет общие константы и функции для преобразования цветов,
 * устраняя дублирование кода в различных фильтрах.
 */
namespace ColorConversionUtils
{
    /**
     * @brief Коэффициенты для преобразования RGB в градации серого
     * 
     * Эти коэффициенты основаны на восприятии яркости человеческим глазом:
     * - Зеленый канал имеет наибольший вес (0.587), так как глаз наиболее чувствителен к зеленому
     * - Красный канал имеет средний вес (0.299)
     * - Синий канал имеет наименьший вес (0.114)
     * 
     * Используется целочисленная арифметика для оптимизации:
     * Y = (R_COEFF * R + G_COEFF * G + B_COEFF * B) >> 16
     * Это эквивалентно формуле с коэффициентами 0.299, 0.587, 0.114
     */
    namespace GrayscaleCoefficients
    {
        /**
         * @brief Коэффициент для красного канала (0.299 * 65536)
         */
        constexpr int R_COEFF = 19595;

        /**
         * @brief Коэффициент для зеленого канала (0.587 * 65536)
         */
        constexpr int G_COEFF = 38470;

        /**
         * @brief Коэффициент для синего канала (0.114 * 65536)
         */
        constexpr int B_COEFF = 7471;
    }

    /**
     * @brief Преобразует RGB в градации серого
     * 
     * Использует целочисленную арифметику для оптимизации производительности.
     * 
     * @param r Значение красного канала [0, 255]
     * @param g Значение зеленого канала [0, 255]
     * @param b Значение синего канала [0, 255]
     * @return Значение яркости в градациях серого [0, 255]
     */
    inline uint8_t rgbToGrayscale(int r, int g, int b)
    {
        return static_cast<uint8_t>((GrayscaleCoefficients::R_COEFF * r + 
                                     GrayscaleCoefficients::G_COEFF * g + 
                                     GrayscaleCoefficients::B_COEFF * b) >> 16);
    }

    /**
     * @brief Преобразует RGB в градации серого (возвращает int для дальнейших вычислений)
     * 
     * Используется когда нужно промежуточное значение для дальнейших вычислений.
     * 
     * @param r Значение красного канала [0, 255]
     * @param g Значение зеленого канала [0, 255]
     * @param b Значение синего канала [0, 255]
     * @return Значение яркости в градациях серого [0, 255] (как int)
     */
    inline int rgbToGrayscaleInt(int r, int g, int b)
    {
        return (GrayscaleCoefficients::R_COEFF * r + 
                GrayscaleCoefficients::G_COEFF * g + 
                GrayscaleCoefficients::B_COEFF * b) >> 16;
    }
}

